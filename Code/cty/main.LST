C51 COMPILER V9.01   MAIN                                                                  05/13/2016 19:04:20 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*****************HJ-4WD»Û¾»ËÄÇýÀ¶ÑÀÖÇÄÜÐ¡³µÀý³Ì*****************
   2          *  Æ½Ì¨£ºHJ-4WD/HJ-E/HL-1ÖÇÄÜÐ¡³µ + Keil U4 + STC89C52
   3          *  Ãû³Æ£º
   4          *  ¹«Ë¾£º»Û¾»µç×Ó¿Æ¼¼ÓÐÏÞ¹«Ë¾
   5          *  ÌÔ±¦£ºhttp://shop37031453.taobao.com       
   6          *  ÍøÕ¾£ºwww.hjmcu.com  ÖÇÄÜÐ¡³µ×¨ÓÃÍøÕ¾£ºWWW.HLMCU.COM
   7          *  ±àÐ´£º
   8          *  ÈÕÆÚ£º2008-8-08
   9          *  ½»Á÷:ÖÇÄÜ³µQQ:1526248688  ¿ª·¢°åQQ:398115088
  10          *  ¾§Õñ:11.0592MHZ
  11          *  ËµÃ÷£ºÃâ·Ñ¿ªÔ´£¬²»Ìá¹©Ô´´úÂë·ÖÎö£¬ÓÐÎÊÌâÖ±½Óµ½»Û¾»ÂÛÌ³½»Á÷
  12          *  ÂÛÌ³£ºhttp://hjdz.haotui.com 
  13          *  Ãâ·Ñ½áÔµ£º5ÐÇºÃÆÀÔùËÍ18¸ö×ÊÁÏ°ü£¬×·¼ÓÆÀ¼ÛºóÔÙ¼ÓËÍ20G×ÊÁÏ£¬ÍøÉÏÍøÅÌÏÂÔØ
  14          *  ÊÓÆµ½Ì³Ì£º±¾Ð¡³µÅäÌ×ÏêÏ¸ÊÓÆµ½Ì³Ì£¬ÓÐÐèÒªÇëµ½»Û¾»ÍøÕ¾Ãâ·ÑÏÂÔØ
  15          ******************************************************************/
  16              // ±¾³ÌÐò²»ÊäÈëPWM£¬J21 PWM 4¸öÌøÏßÃ±²»Òª×°ÉÏ£¬°ÑJ20(IN)/J22(EN) 8¸öÌøÏßÃ±×°ÉÏ£¬ÕâÑùÐ¡³µ¾ÍÄÜÈ«ËÙ¶ÈÔËÐÐ
             -¡£        
  17                  //×¢Òâ³ÌÐòÖ»×ö²Î¿¼Ö®ÓÃ£¬Òª´ïµ½×îÀíÏëµÄÐ§¹û£¬»¹ÐèÒªÍ¬Ñ§ÃÇÏ¸ÐÄµ÷ÊÔ¡£      
  18                  //×¢Òâ³¬Éù²¨½ÓÏß£¬¼±ÐÔÖ®ÈË¾­³£½Ó´íÏß£¬ÉÕ»µÄ£¿é£¬ÇëÒ»¶¨ÒªºË¶ÔºÃÔÙÍ¨µçÊÔÑé£¬Ä£¿é½Ó´íÏßÉÕ»µ²»±£ÐÞ£¬²»»»»õµÄ¡
             -£
  19                  /****************************************************************************
  20                   Ó²¼þÁ¬½Ó
  21                   ¶æ»úÓÐÈýÌõÏß¶¨Òå£º
  22          
  23               °µ»Ò£º GND
  24          
  25               ºìÉ«£º VCC 4.8-5.2V
  26          
  27               ³È»ÆÏß£º Âö³åÊäÈë
  28          
  29                   °Ñ¶æ»ú²åÈëµ¥Æ¬»úJ9½Ó¿ÚÖÐ        --×¢Òâ²»Òª½Ó´íÏß£¬·ñÔòÉÕ»µ¶æ»ú£¬²»±£ÐÞ£¬²»»»»õ¡£
  30                   ³¬Éù²¨ÓÃ¶Å°îÏß½Óµ½J6¿ÚÖÐ
  31                   ×Ô¼º°²×°ºÃ¶æ»ú£¬»¹ÓÐ³¬Éù²¨¹Ì¶¨¼Ü£¬Ð¡³µ²âÊÔÊ±Ð¡ÐÄ²»ÒªÅö×²µ½ÎïÌå£¬·ñÔòÈÝÒ×¶Ï¹Ì¶¨Ö§¼Ü
  32                  ****************************************************************************/
  33          
  34          #include <STC89Cxx.h>
  35          #include <intrins.h>
  36          
  37                  #define Sevro_moto_pwm     P27     //½Ó¶æ»úÐÅºÅ¶ËÊäÈëPWMÐÅºÅµ÷½ÚËÙ¶È
  38          
  39                  #define  ECHO  P24                                 //³¬Éù²¨½Ó¿Ú¶¨Òå
  40                  #define  TRIG  P25                                 //³¬Éù²¨½Ó¿Ú¶¨Òå
  41          
  42                  //HJ-4WDÐ¡³µÇý¶¯½ÓÏß¶¨Òå
  43              #define Right_moto_go      {P14=1,P15=0,P16=1,P17=0;}    //×ó±ßÁ½¸öµç»úÏòÇ°×ß
  44                  #define Right_moto_back    {P14=0,P15=1,P16=0,P17=1;}    //×ó±ßÁ½¸öµç»úÏòºó×ª
  45                  #define Right_moto_Stop    {P14=0,P15=0,P16=0,P17=0;}    //×ó±ßÁ½¸öµç»úÍ£×ª                     
  46                  #define Left_moto_go     {P10=1,P11=0,P12=1,P13=0;}     //ÓÒ±ßÁ½¸öµç»úÏòÇ°×ß
  47                  #define Left_moto_back   {P10=0,P11=1,P12=0,P13=1;}     //ÓÒ±ßÁ½¸öµç»úÏòºó×ß
  48                  #define Left_moto_Stop   {P10=0,P11=0,P12=0,P13=0;}     //ÓÒ±ßÁ½¸öµç»úÍ£×ª  
  49          
  50          
  51                  unsigned char const discode[] ={ 0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90,0xBF,0xff/*-*/};
  52                  unsigned char const positon[3]={ 0xfe,0xfd,0xfb};
  53                  unsigned char disbuff[4]          ={ 0,0,0,0,};
C51 COMPILER V9.01   MAIN                                                                  05/13/2016 19:04:20 PAGE 2   

  54              unsigned char posit=0;
  55              unsigned char status;                       //´ýÏÔÊ¾×Ö·û¡£
  56                  volatile unsigned char sending;
  57          
  58                  unsigned char pwm_val_left  = 0;//±äÁ¿¶¨Òå
  59                  unsigned char push_val_left =14;//¶æ»ú¹éÖÐ£¬²úÉúÔ¼£¬1.5MS ÐÅºÅ
  60              unsigned long S=0;
  61                  unsigned long S1=0;
  62                  unsigned long S2=0;
  63                  unsigned long S3=0;
  64                  unsigned long S4=0;
  65                  unsigned int  time=0;               //Ê±¼ä±äÁ¿
  66                  unsigned int  timer=0;                  //ÑÓÊ±»ù×¼±äÁ¿
  67                  unsigned char timer1=0;                 //É¨ÃèÊ±¼ä±äÁ¿                                  
  68          /************************************************************************/
  69                          void delay(unsigned int k)        //ÑÓÊ±º¯Êý
  70          {    
  71   1           unsigned int x,y;
  72   1                 for(x=0;x<k;x++) 
  73   1                   for(y=0;y<2000;y++);
  74   1      }
  75          /************************************************************************/
  76              void Display(void)                            //É¨ÃèÊýÂë¹Ü
  77                  { 
  78   1               P0=discode[disbuff[posit]];
  79   1      
  80   1                if(posit==0)
  81   1                {P21=0;P22=1;P23=1;}
  82   1                if(posit==1)
  83   1                {P21=1;P22=0;P23=1;}
  84   1                if(posit==2)
  85   1                {P21=1;P22=1;P23=0;}
  86   1                if(++posit>=3)
  87   1                {posit=0;}
  88   1              }
  89          /************************************************************************/
  90               void  StartModule()                      //Æô¶¯²â¾àÐÅºÅ£¬¸øTRIGÒ»¸ö15usµÄ¸ßµçÆ½
  91             {
  92   1                TRIG=1;                                       
  93   1                _nop_(); 
  94   1                _nop_(); 
  95   1                _nop_(); 
  96   1                _nop_(); 
  97   1                _nop_(); 
  98   1                _nop_(); 
  99   1                _nop_(); 
 100   1                _nop_(); 
 101   1                _nop_(); 
 102   1                _nop_(); 
 103   1                _nop_(); 
 104   1                _nop_(); 
 105   1                _nop_(); 
 106   1                _nop_(); 
 107   1                _nop_(); 
 108   1                TRIG=0;
 109   1         }
 110           /***************************************************/
 111                    void Conut(void)                 //¼ÆËã¾àÀë
 112                  {
 113   1                while(!ECHO);                //µ±RXÎªÁãÊ±µÈ´ý
 114   1                TR0=1;                               //¿ªÆô¼ÆÊý
 115   1                while(ECHO);                     //µ±RXÎª1¼ÆÊý²¢µÈ´ý
C51 COMPILER V9.01   MAIN                                                                  05/13/2016 19:04:20 PAGE 3   

 116   1                TR0=0;                                   //¹Ø±Õ¼ÆÊý
 117   1                time=TH0*256+TL0;                //¶ÁÈ¡Âö¿í³¤¶È
 118   1                TH0=0;
 119   1                TL0=0;
 120   1                S=(time*1.7)/100;        //Ëã³öÀ´ÊÇCM
 121   1                disbuff[0]=S%1000/100;   //¸üÐÂÏÔÊ¾
 122   1                disbuff[1]=S%1000%100/10;
 123   1                disbuff[2]=S%1000%100%10;
 124   1              }
 125          /************************************************************************/
 126          //Ç°ËÙÇ°½ø
 127               void  run(void)
 128          {                                  
 129   1               Left_moto_go ;     //×óµç»úÍùÇ°×ß
 130   1               Right_moto_go ;    //ÓÒµç»úÍùÇ°×ß
 131   1      }
 132          /************************************************************************/
 133          //Ç°ËÙºóÍË
 134               void  backrun(void)
 135          {
 136   1               Left_moto_back ;   //×óµç»úºó×ß
 137   1               Right_moto_back ;  //ÓÒµç»úÍùºó×ß
 138   1      }
 139          /************************************************************************/
 140          //×ó×ª
 141               void  leftrun(void)
 142          {
 143   1               Left_moto_back ;   //×óµç»úÍùºó×ß
 144   1               Right_moto_go ;   //ÓÒµç»úÍùÇ°×ß
 145   1      }
 146          /************************************************************************/
 147          //ÓÒ×ª
 148               void  rightrun(void)
 149          {
 150   1               Left_moto_go ;     //×óµç»úÍùÇ°×ß
 151   1               Right_moto_back ;  //ÓÒµç»úÍùºó×ß
 152   1      }
 153          /************************************************************************/
 154          //STOP
 155               void  stoprun(void)
 156          {
 157   1               Left_moto_Stop ;   //×óµç»úÍ£×ß
 158   1               Right_moto_Stop ;  //ÓÒµç»úÍ£×ß
 159   1      }
 160          /************************************************************************/
 161          //  void  COMM( void )                
 162          //   {
 163                       
 164                           
 165          //                push_val_left=5;        //¶æ»úÏò×ó×ª90¶È
 166          //                timer=0;
 167          //                while(timer<=4000); //ÑÓÊ±400MSÈÃ¶æ»ú×ªµ½ÆäÎ»ÖÃ                4000
 168          //                StartModule();          //Æô¶¯³¬Éù²¨²â¾à
 169          //           Conut();                     //¼ÆËã¾àÀë
 170          //                S2=S;  
 171            
 172          //                push_val_left=23;       //¶æ»úÏòÓÒ×ª90¶È
 173          //                timer=0;
 174          //                while(timer<=4000); //ÑÓÊ±400MSÈÃ¶æ»ú×ªµ½ÆäÎ»ÖÃ
 175          //                StartModule();          //Æô¶¯³¬Éù²¨²â¾à
 176          //           Conut();                     //¼ÆËã¾àÀë
 177          //                S4=S;         
C51 COMPILER V9.01   MAIN                                                                  05/13/2016 19:04:20 PAGE 4   

 178                  
 179          
 180          //                push_val_left=14;       //¶æ»ú¹éÖÐ
 181          //                timer=0;
 182          //                while(timer<=4000); //ÑÓÊ±400MSÈÃ¶æ»ú×ªµ½ÆäÎ»ÖÃ
 183          
 184          //                StartModule();          //Æô¶¯³¬Éù²¨²â¾à
 185          //           Conut();                     //¼ÆËã¾àÀë
 186          //                S1=S;         
 187          
 188          //           if((S2<20)||(S4<20)) //Ö»Òª×óÓÒ¸÷ÓÐ¾àÀëÐ¡ÓÚ£¬20CMÐ¡³µºóÍË
 189          //                {
 190          //                backrun();               //ºóÍË
 191          //                timer=0;
 192          //                while(timer<=4000);
 193          //                }
 194                             
 195          //                if(S2>S4)              
 196          //                   {
 197          //                              rightrun();     //³µµÄ×ó±ß±È³µµÄÓÒ±ß¾àÀëÐ¡      ÓÒ×ª    
 198          //                      timer=0;
 199          //                      while(timer<=4000);
 200          //                   }                                
 201          //                     else
 202          //                   {
 203          //                     leftrun();               //³µµÄ×ó±ß±È³µµÄÓÒ±ß¾àÀë´ó      ×ó×ª
 204          //                     timer=0;
 205          //                     while(timer<=4000);
 206          //                   }
 207                                                     
 208          
 209          // }
 210          
 211          /************************************************************************/
 212          /*                    PWMµ÷ÖÆµç»ú×ªËÙ                                   */
 213          /************************************************************************/
 214          /*                    ×óµç»úµ÷ËÙ                                        */
 215          /*µ÷½Úpush_val_leftµÄÖµ¸Ä±äµç»ú×ªËÙ,Õ¼¿Õ±È            */
 216          //              void pwm_Servomoto(void)
 217          // {  
 218           
 219          //     if(pwm_val_left<=push_val_left)
 220          //             Sevro_moto_pwm=1; 
 221          //      else 
 222          //             Sevro_moto_pwm=0;
 223          //      if(pwm_val_left>=200)
 224          //      pwm_val_left=0;
 225           
 226          // }
 227          /***************************************************/
 228          ///*TIMER1ÖÐ¶Ï·þÎñ×Óº¯Êý²úÉúPWMÐÅºÅ*/
 229                  void time1()interrupt 3   using 2
 230          {       
 231   1           TH1=(65536-100)/256;         //100US¶¨Ê±
 232   1               TL1=(65536-100)%256;
 233   1               timer++;                                 //¶¨Ê±Æ÷100USÎª×¼¡£ÔÚÕâ¸ö»ù´¡ÉÏÑÓÊ±
 234   1               pwm_val_left++;
 235   1               // pwm_Servomoto();
 236   1      
 237   1               timer1++;                               //2MSÉ¨Ò»´ÎÊýÂë¹Ü
 238   1               if(timer1>=20)
 239   1               {
C51 COMPILER V9.01   MAIN                                                                  05/13/2016 19:04:20 PAGE 5   

 240   2               timer1=0;
 241   2               Display();     
 242   2               }
 243   1       }
 244          /***************************************************/
 245          ///*TIMER0ÖÐ¶Ï·þÎñ×Óº¯Êý²úÉúPWMÐÅºÅ*/
 246                  void timer0()interrupt 1   using 0
 247          {       
 248   1              
 249   1       }
 250          
 251          /***************************************************/
 252          
 253                  void init(void)                         //´®¿Ú³õÊ¼»¯
 254          {
 255   1              EA=0; //ÔÝÊ±¹Ø±ÕÖÐ¶Ï
 256   1      //T2¶¨Ê±Æ÷Ïà¹ØÉè¶¨
 257   1              T2CON&=0x0F;
 258   1              T2CON|=0x30;
 259   1              RCAP2H=255;
 260   1              RCAP2L=255;
 261   1              TL2=255;
 262   1              TH2=255;
 263   1      //´®¿ÚÏà¹ØÉè¶¨
 264   1              SCON=0x50;     //´®¿Ú¹¤×÷ÔÚÄ£Ê½1
 265   1              PCON|=0x80;    //´®¿Ú²¨ÌØÂÊ¼Ó±¶
 266   1              ES=1;         //´®ÐÐÖÐ¶ÏÔÊÐí
 267   1      //¶¨Ê±Æ÷T0,T1Éè¶¨
 268   1              TMOD=0X11;
 269   1              TH1=(65536-100)/256;      //100US¶¨Ê±
 270   1              TL1=(65536-100)%256;
 271   1              TH0=0;
 272   1              TL0=0;  
 273   1      
 274   1              ET1= 1;
 275   1              ET0= 1;
 276   1      
 277   1              TR1= 1;         //Æô¶¯¶¨Ê±Æ÷1
 278   1              TR2=1;      //Æô¶¯¶¨Ê±Æ÷2
 279   1      
 280   1              EA=1;         //ÔÊÐíÖÐ¶Ï
 281   1      }
 282          
 283                  void send(unsigned char d)                //·¢ËÍÒ»¸ö×Ö½ÚµÄÊý¾Ý£¬ÐÎ²Îd¼´Îª´ý·¢ËÍÊý¾Ý¡£
 284          {
 285   1       
 286   1              SBUF=d; //½«Êý¾ÝÐ´Èëµ½´®¿Ú»º³å
 287   1              sending=1;       //ÉèÖÃ·¢ËÍ±êÖ¾
 288   1              while(sending); //µÈ´ý·¢ËÍÍê±Ï
 289   1      }
 290          
 291                  void uart(void) interrupt 4              //´®¿Ú·¢ËÍÖÐ¶Ï
 292          {
 293   1      
 294   1              TI=0;
 295   1              sending=0;  //ÇåÕýÔÚ·¢ËÍ±êÖ¾
 296   1       
 297   1      }
 298           /***************************************************/
 299          
 300                  void main(void)
 301          {
C51 COMPILER V9.01   MAIN                                                                  05/13/2016 19:04:20 PAGE 6   

 302   1      
 303   1      
 304   1              while(1)                       /*ÎÞÏÞÑ­»·*/
 305   1              { 
 306   2                 leftrun();
 307   2              
 308   2      
 309   2              }
 310   1                
 311   1                
 312   1          
 313   1      }
 314          
 315                  


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    522    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     49    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
